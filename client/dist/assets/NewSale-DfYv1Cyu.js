import{r as i,u as P,j as e,A as h,b,_ as u}from"./index-R32pK0TL.js";const w=()=>{const[c,m]=i.useState([]),[g,y]=i.useState(!0),[d,N]=i.useState(""),x=P();i.useEffect(()=>{(async()=>{try{const s=await(await fetch(`${b}/sub-sales`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"})).json();console.log(s);const t=s.subSales.map(a=>(a.totalAmount=a.products.reduce((o,l)=>o+l.pricePerUnit*l.quantity,0),a));m(t)}catch(r){console.error("Error fetching sub-sales:",r)}finally{y(!1)}})()},[]);const p=(n,r,s)=>{m(t=>{const a=[...t],o=a[n],l=o.products[r];return l.quantity+=s,l.quantity<1&&(l.quantity=1),l.totalPrice=l.pricePerUnit*l.quantity,o.totalAmount=o.products.reduce((f,S)=>f+S.totalPrice,0),a})},j=async()=>{if(!d){u.error("Please enter customer name");return}const n=c[0]._id,r=c[0].products.map(t=>({productName:t.productName,quantity:t.quantity,pricePerUnit:t.pricePerUnit,totalPrice:t.totalPrice})),s={customer:d,subSalesId:n,products:r};try{const a=await(await fetch(`${b}/sales/add`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)})).json();a.success?(u.success("Bill generated"),x(`/invoice/${a.sale._id}`)):u.error(a.message)}catch(t){console.error("Error generating bill:",t)}};return g?e.jsx(h,{children:e.jsx("div",{className:"text-center p-6",children:"Loading..."})}):e.jsx(h,{children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-700 mb-6",children:"Sub Sales"}),c.length>0?e.jsxs("div",{className:"bg-white p-6 shadow-lg rounded-lg",children:[e.jsxs("table",{className:"min-w-full bg-white border border-gray-300 rounded-lg",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 border-b",children:[e.jsx("th",{className:"px-4 py-3 text-left text-gray-600 font-semibold",children:"Product Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-600 font-semibold",children:"Quantity"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-600 font-semibold",children:"Price Per Unit"}),e.jsx("th",{className:"px-4 py-3 text-left text-gray-600 font-semibold",children:"Total Price"})]})}),e.jsx("tbody",{children:c.map((n,r)=>n.products.map((s,t)=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 transition",children:[e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.productName}),e.jsxs("td",{className:"px-4 py-3 text-gray-700 flex items-center",children:[e.jsx("button",{className:"bg-gray-200 px-2 py-1 rounded-lg mr-2",onClick:()=>p(r,t,-1),children:"-"}),s.quantity,e.jsx("button",{className:"bg-gray-200 px-2 py-1 rounded-lg ml-2",onClick:()=>p(r,t,1),children:"+"})]}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.pricePerUnit}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.totalPrice})]},s._id)))})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("label",{htmlFor:"customerName",className:"block text-gray-700 font-semibold mb-2",children:"Customer Name:"}),e.jsx("input",{id:"customerName",type:"text",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-600",placeholder:"Enter customer name",value:d,onChange:n=>N(n.target.value)})]}),e.jsxs("div",{className:"mt-6 text-right",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Total Amount: ₹",c[0].totalAmount]}),e.jsxs("p",{className:"text-gray-500",children:["Tax: ₹",c[0].tax]})]}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-700 transition mt-4",onClick:j,children:"Generate Bill"})]}):e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-700 mb-4",children:"No sub-sales available."}),e.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition",onClick:()=>x("/products"),children:"Add Product to Sale"})]})]})})};export{w as default};
